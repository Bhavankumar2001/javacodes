<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<head>
	<title>Altrocks | Inventory Transfer</title>
	<div th:replace="fragments/Common-topnav :: head"></div>
	<link rel="stylesheet" href="/plugins/daterangepicker/daterangepicker.css">
	<style>
		tfoot {
			display: table-row-group;
		}
	</style>
</head>

<body class="hold-transition layout-top-nav">
	<div class="wrapper">
		<div th:replace="fragments/Common-topnav :: navbar"></div>

		<div class="content-wrapper diplayimg">
			<div class="content-header">
				<div class="container">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1 class="m-0"><img src="/dist/img/doc.png" alt="doc icon"> Description</h1>
						</div>
					</div>
				</div>
			</div>

			<div class="content">
				<div class="container">

					<!-- CREATE SECTION -->
					<div class="card shadow mb-4" id="create-section">
						<div class="card-header  text-black font-weight-bold">
							Create
						</div>
						<div class="card-body">
							<div class="form-row">
								<div class="form-group col-md-6">
									<label for="create-type">Type</label>
									<select class="form-control" id="create-type" required>
										<option value="">-- Select --</option>
										<option value="Expansion">Expansion</option>
										<option value="Renovation">Renovation</option>
										<option value="Maintenance">Maintenance</option>
									</select>
								</div>
								<div class="form-group col-md-6">
									<label for="create-description">Description</label>
									<textarea class="form-control" id="create-description" rows="2"
										placeholder="Enter description" required></textarea>
								</div>
							</div>
							<div class="text-right">
								<button class="btn btn-success" onclick="saveCreate()">Save</button>
							</div>
						</div>
					</div>

					<!-- VIEW SECTION -->
					<div class="card shadow mb-4" id="view-section" style="display: none;">
						<div class="card-header  text-black font-weight-bold">
							View
						</div>
						<div class="card-body">
							<table class="table table-bordered table-sm">
								<thead class="thead-light">
									<tr>
										<th>S.NO</th>
										<th>Type</th>
										<th>Description</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody id="view-table-body">
									<!-- Rows will be added dynamically -->
								</tbody>
							</table>
						</div>
					</div>

					<!-- EDIT MODAL -->
					<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel"
						aria-hidden="true">
						<div class="modal-dialog modal-lg">
							<div class="modal-content">
								<div class="modal-header  text-black">
									<h5 class="modal-title" id="editModalLabel">Edit</h5>
									<button type="button" class="close text-white" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<div class="form-row">
										<div class="form-group col-md-6">
											<label for="edit-type">Type</label>
											<select class="form-control" id="edit-type">
												<option value="">-- Select --</option>
												<option value="Expansion">Expansion</option>
												<option value="Renovation">Renovation</option>
												<option value="Maintenance">Maintenance</option>
											</select>
										</div>
										<div class="form-group col-md-6">
											<label for="edit-description">Description</label>
											<textarea class="form-control" id="edit-description" rows="2"
												placeholder="Enter description" required></textarea>
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<input type="hidden" id="edit-id">
									<button type="button" class="btn btn-success" onclick="saveEdit()">Save</button>
									<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>

				</div> <!-- container -->
			</div> <!-- content -->
		</div> <!-- content-wrapper -->
	</div>


	<script src="/plugins/moment/moment.min.js"></script>
	<script src="/plugins/daterangepicker/daterangepicker.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

	<!-- Bootstrap JS (required for modal) -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>


	</div>
</body>

<script>
	let rowCounter = 1;
	let editingIndex = null;

	function saveCreate() {
		const type = document.getElementById("create-type").value;
		const description = document.getElementById("create-description").value;

		if (!type || !description) {
			Swal.fire({
				icon: 'warning',
				text: 'Please select a type and enter a description.',
				confirmButtonColor: '#3085d6',
				confirmButtonText: 'OK'
			});
			return;
		}

		// API call to backend
		fetch('/capex/sterling/save', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({
				type: type,
				description: description,
				created_by: '',     // Replace with actual user if available
				updated_by: ''
			})
		})
			.then(response => {
				if (!response.ok) throw new Error("Failed to save");
				return response.json(); // Expecting ID in response
			})
			.then(data => {
				const tbody = document.getElementById("view-table-body");
				const row = tbody.insertRow();
				row.setAttribute("data-id", data.id); // âœ… Save ID to row

				row.innerHTML = `
				<td>${rowCounter++}</td>
				<td>${data.type}</td>
				<td>${data.description}</td>
				<td><button class="btn btn-sm btn-primary" onclick="editRow(this)">Edit</button></td>
			`;

				// Clear inputs
				document.getElementById("create-type").value = "";
				document.getElementById("create-description").value = "";
				document.getElementById("view-section").style.display = "block";

				Swal.fire('Success', 'Saved successfully', 'success');
			})

			.catch(error => {
				Swal.fire({
					icon: 'error',
					text: 'Save failed: ' + error.message,
					confirmButtonColor: '#d33',
					confirmButtonText: 'OK'
				});
			});
	}


	function editRow(button) {
		const row = button.closest("tr");
		editingIndex = row.rowIndex - 1;

		const type = row.cells[1].innerText;
		const description = row.cells[2].innerText;
		const id = row.getAttribute("data-id");

		document.getElementById("edit-type").value = type;
		document.getElementById("edit-description").value = description;
		document.getElementById("edit-id").value = id;

		// Show modal
		$('#editModal').modal('show');
	}



	function saveEdit() {
		const type = document.getElementById("edit-type").value;
		const description = document.getElementById("edit-description").value;
		const id = document.getElementById("edit-id").value; // Fixed here

		if (!id || editingIndex === null) return;

		// Send PUT request to backend
		fetch('/capex/sterling/update/' + id, {
			method: 'PUT',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({
				type: type,
				description: description
			})
		})
			.then(response => {
				if (!response.ok) throw new Error("Update failed");
				return response.text();
			})
			.then(() => {
				const tbody = document.getElementById("view-table-body");
				const row = tbody.rows[editingIndex];
				row.cells[1].innerText = type;
				row.cells[2].innerText = description;

				editingIndex = null;
				$('#editModal').modal('hide'); // Close modal

				Swal.fire('Success', 'Updated successfully', 'success');
			})
			.catch(err => {
				Swal.fire('Error', 'Update failed: ' + err.message, 'error');
			});
	}




</script>

<div th:replace="fragments/Common-topnav :: footer"></div>

</html>