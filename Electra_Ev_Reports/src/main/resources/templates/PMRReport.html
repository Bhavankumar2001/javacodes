<!DOCTYPE html>
<html lang="en">

<!-- fragment :  HeaderLinks -->
<title>Electra EV || Electra EV Performance Monitoring Report</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>

<script src="/dist/js/supplierperf.js"></script>
<div th:replace="fragments/common :: head"></div>


<!-- Include jQuery, DataTables, Buttons, and FileSaver -->
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
<link rel="stylesheet"
	href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script
	src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
<script
	src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
<style>
.card {
	box-shadow: 5px 5px 10px #C1DBFE;
	border-radius: 10px;
}
</style>
<!--  HeaderLinks -->

<body class="hold-transition  sidebar-collapse">
	<!-- Site wrapper -->
	<div class="wrapper">

		<!-- fragment :  Navbar -->
		<div
			th:replace="fragments/common :: TopNavBar ('ME2L Report','/multivista/report/me2l')"></div>
		<!-- /.Navbar -->



		<!--  fragment : Main Sidebar Container -->

		<!-- Content Wrapper. Contains page content -->
		<div class="">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<div class="container">
					<form action="/electraev/supplierperf/filter" th:object="${Data}"
						method="POST">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">
									<img src="/dist/img/filter1.png" height="25px;"> Date
									Selection
								</h3>
								<div class="card-tools">
									<button type="button" class="btn btn-tool"
										data-card-widget="collapse">
										<i class="fas fa-minus"></i>
									</button>

								</div>
							</div>
							<div class="card-body">
								<div class="row">

									<div class="col-md-3">
										<label><img src="/dist/img/calendar.png"
											height="20px;"> From Date :</label>

										<input type="month" id="start" name="fromDate"
											class="form-control form-control-sm" min="1999-03"  />
										<!-- <input type="date" name="fromDate" required
											class="form-control form-control-sm" /> -->

										<span th:text="${fromDate}" class="text-bold"></span>
									</div>
									<div class="col-md-3">
										<label><img src="/dist/img/calendar.png"
											height="20px;"> To Date :
										</label> <input type="month" id="start" name="toDate"
											class="form-control form-control-sm" min="1999-03"  />
										<!-- 	 <input type="date" name="toDate"
											class="form-control form-control-sm" required />  -->
										<span th:text="${toDate}" class="text-bold"></span>
									</div>
									<div class="col-md-2 mt-4">
										<button type="submit" class="btn btn-sm btn-outline-info mt-2">Filter</button>
									</div>

								</div>
								<div class="row mt-2">
									<div class="col-md-3">
										<label> Supplier :<span style="color: red;">*</span>
										</label> <select class="form-control select2" name="supplierField"
											multiple style="width: 100%;" required>
											<option th:each="obj : ${uniqueSupplier}"
												th:value="${obj.dSupplier}"
												th:text="${obj.dSupplier} +' - '+ ${obj.dSupplierFullName} "></option>
										</select> <span th:text="${supplierField}" style="color: blue;"
											class="text-bold"></span>
									</div>


								</div>

							</div>
						</div>
					</form>
				</div>
				<!-- /.container-fluid -->
			</section>

			<!-- Main content -->
			<section class="container-fluid">

				<div th:if="${#lists.isEmpty(data)}" align="center" class="card">
					<span style="align: center; color: #ffff"> <img
						src="/dist/img/NoData3.png" class="text-center" height="350px;">
					</span>
					<h5>
						Select the <img src="/dist/img/calendar.png" height="25px;">
						Parameters to fetch the ME2L List !!
					</h5>
				</div>
				<!-- <div class="card">

					<div class="card-body">

						<button class="btn btn-primary" id="exportBtn">Export to
							Excel</button>
					</div>
				</div> -->
				<!-- Default box -->
				<div class="card card-solid">
					<div class=" card-body" style="overflow-x: auto"
						th:if="!${#lists.isEmpty(data)}">
						<table id="dataTable"
							class="table table-hover table-bordered table-sm dataTables-example statusToggle">
							<thead>
								<tr class="text-center">
									<th style="background-color: #5697B7;">S.No</th>
									<th style="background-color: #5697B7;">Supplier</th>
									<th style="background-color: #5697B7;">Supplier Name</th>
									<th style="background-color: #5697B7;">Material</th>
									<th style="background-color: #5697B7;">Material
										Description</th>
									<th style="background-color: #5697B7;">Total Scheduled lot
										qty</th>
									<th style="background-color: #5697B7;">Total Received lot</th>
									<th style="background-color: #5697B7;">Rejection Qty</th>
									<th style="background-color: #5697B7;">Line Disruption</th>
									<th style="background-color: #5697B7;">Customer Complaint</th>
									<th style="background-color: #5697B7;">Warranty Complaint</th>
									<th style="background-color: #5697B7;">Premium Freight
										rating</th>
									<th style="background-color: #5697B7;">Quality Rating for
										Suppliers</th>
									<th style="background-color: #5697B7;">Delivery Rating for
										Suppliers</th>
									<th style="background-color: #5697B7;">Supplier Rating</th>
									<th style="background-color: #5697B7;">Remark</th>



								</tr>
							</thead>
							<tbody>
								<tr th:each="data,iterator:${data}">
									<td title="index" th:text="${iterator.index+1}"></td>
									<td title="Supplier" th:text="${data.dSupplier}"></td>
									<td title="Supplier Name" th:text="${data.dSupplierFullName}"></td>
									<td title="Material" th:text="${data.dMaterial}"></td>
									<td title="MaterialDescription" th:text="${data.dProductName}"></td>
									<td title="Total Scheduled lot qty" th:text="${data.Sumation}"></td>
									<td title="Total Received lot" th:text="${data.Unitentry321}"></td>
									<td title="Rejection Qty" th:text="${data.Unitentry350}"></td>
									<td title="Line Disruption"
										style="text-align: center; vertical-align: middle;"><input
										class="form-control input1" id="lineDisruptionInput"
										type="Number" /></td>
									<td title="Customer Complaint"
										style="text-align: center; vertical-align: middle;"><input
										class="form-control input2" type="Number"
										onchange="calculate()" /></td>
									<td title="Warranty Complaint"
										style="text-align: center; vertical-align: middle;"><input
										type="Number" class="form-control input3" /></td>
									<td title="Premium Freight rating"
										style="text-align: center; vertical-align: middle;"><input
										type="Number" class="form-control input4" /></td>
									<td title="Quality Rating for Suppliers"
										th:text="${#numbers.formatDecimal(data.Qualityrating,0, 'COMMA', 2, 'POINT')}"
										class="qualityrating"></td>
									<td title="Delivery Rating for Suppliers"
										th:text="${#numbers.formatDecimal(data.Deliveryrating,0, 'COMMA', 2, 'POINT')}"></td>
									<td title="Supplier Rating" class="sum"></td>

									<td title="Rating" th:text="${ame}"></td>

								</tr>
							</tbody>
						</table>



					</div>
					<!-- /.card-body -->

					<!-- /.card-footer -->
				</div>
				<!-- /.card -->

			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		<!--  fragment : Main Footer -->
		<div th:replace="fragments/common :: main-footer"></div>
		<!-- /. Main Footer -->


		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
			<!-- Control sidebar content goes here -->
		</aside>
		<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<!--  fragment : Footer Links -->
	<div th:replace="fragments/common :: footer-links"></div>
	<!-- /.  Footer Links  -->




	<script>
		$(document)
				.ready(
						function() {
							// Initialize DataTables with export buttons
							var table = $('#dataTable').DataTable({
								dom : 'Bfrtip',
								buttons : [ {
									text : 'Excel',
									action : function() {
										exportTableToExcel();
									}
								}, 'copy', 'csv', 'pdf', 'print' ],
								paging : true,
								ordering : false, // Disable sorting
								info : false
							});

							// Function to calculate sum and display in the 'Supplier Rating' column
							function calculateSum() {
								$('#dataTable tbody tr')
										.each(
												function() {
													var input1 = parseFloat($(
															this).find(
															'.input1').val()) || 0;
													var input2 = parseFloat($(
															this).find(
															'.input2').val()) || 0;
													var input3 = parseFloat($(
															this).find(
															'.input3').val()) || 0;
													var input4 = parseFloat($(
															this).find(
															'.input4').val()) || 0;
													var qualityRating = parseFloat($(
															this).find(
															'td:nth-child(13)')
															.text()) || 0;
													var deliveryRating = parseFloat($(
															this).find(
															'td:nth-child(14)')
															.text()) || 0;
													var sum = (qualityRating * 0.45)
															+ (deliveryRating * 0.25)
															+ input1
															+ input2
															+ input3 + input4;

													if (isNaN(sum)) {
														sum = 0;
													}

													$(this).find('.sum').text(
															sum);
												});
							}

							// Event delegation for input changes
							$('#dataTable').on('input',
									'.input1, .input2, .input3, .input4',
									function() {
										calculateSum();
									});

							// Function to export table to Excel
							function exportTableToExcel() {
								var wb = XLSX.utils.book_new();
								wb.Props = {
									Title : "Electra_EV_Report",
									Subject : "Export",
									Author : "Your Name",
									CreatedDate : new Date()
								};
								wb.SheetNames.push("Sheet 1");

								var ws_data = [ [ 'S.No', 'Supplier',
										'Supplier Name', 'Material',
										'Material Description',
										'Total Scheduled lot qty',
										'Total Received lot', 'Rejection Qty',
										'Line Disruption',
										'Customer Complaint',
										'Warranty Complaint',
										'Premium Freight rating',
										'Quality Rating for Suppliers',
										'Delivery Rating for Suppliers',
										'Supplier Rating', 'Remark' ] ];
								$('#dataTable tbody tr')
										.each(
												function() {
													var row = [
															$(this)
																	.find(
																			'td:nth-child(1)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(2)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(3)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(4)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(5)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(6)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(7)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(8)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(9) input')
																	.val(),
															$(this)
																	.find(
																			'td:nth-child(10) input')
																	.val(),
															$(this)
																	.find(
																			'td:nth-child(11) input')
																	.val(),
															$(this)
																	.find(
																			'td:nth-child(12) input')
																	.val(),
															$(this)
																	.find(
																			'td:nth-child(13)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(14)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(15)')
																	.text(),
															$(this)
																	.find(
																			'td:nth-child(16)')
																	.text() ];
													ws_data.push(row);
												});

								var ws = XLSX.utils.aoa_to_sheet(ws_data);
								wb.Sheets["Sheet 1"] = ws;

								var wbout = XLSX.write(wb, {
									bookType : 'xlsx',
									type : 'binary'
								});

								function s2ab(s) {
									var buf = new ArrayBuffer(s.length);
									var view = new Uint8Array(buf);
									for (var i = 0; i < s.length; i++)
										view[i] = s.charCodeAt(i) & 0xFF;
									return buf;
								}

								saveAs(new Blob([ s2ab(wbout) ], {
									type : "application/octet-stream"
								}), 'TableExport.xlsx');
							}

							// Calculate sum initially to ensure it is up-to-date
							calculateSum();
						});
	</script>
</body>

</html>